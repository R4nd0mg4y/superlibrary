{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
<div class="container">
    <h1 align="center">Notes</h1>

    <!-- Form to create a new book -->
    {%if user.is_admin == 1%}
    <form method="POST" action="/" enctype="multipart/form-data">
        <div class="form-group">
            <label for="book_title">Book Title:</label>
            <input
                type="text"
                class="form-control"
                id="book_title"
                name="book_title"
                required
            />
        </div>
        <div class="form-group">
            <label for="author">Author:</label>
            <input
                type="text"
                class="form-control"
                id="author"
                name="author"
                required
            />
        </div>
        <div class="form-group">
            <label for="cover">Cover (Image):</label>
            <input
                type="file"
                class="form-control"
                id="cover"
                name="cover"
                accept="image/*" 
            />
        </div>
        <div class="form-group">
            <label for="content">Content (PDF):</label>
            <input
                type="file"
                class="form-control"
                id="content"
                name="content"
                accept=".pdf" 
            />
        </div>
        <button type="submit" name="create_book" class="btn btn-primary">
            Create Book
        </button>
    </form>
    {% endif %}

    <!-- Form to create a new note -->
    <form method="POST" action="/">
        <div class="form-group">
            <label for="book_id">Select a Book:</label>
            <select class="form-control" id="book_id" name="book_id" required>
                {% for book in books %}
                <option value="{{ book.id }}">{{ book.title }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="note">Add Note:</label>
            <textarea
                class="form-control"
                id="note"
                name="note"
                rows="3"
                required
            ></textarea>
        </div>
        <div class="form-group star-rating">
          <label for="rating">Rating:</label>
          <input type="hidden" id="rating" name="rating" value="0">
          <i class="fa fa-star" data-rating="1"></i>
          <i class="fa fa-star" data-rating="2"></i>
          <i class="fa fa-star" data-rating="3"></i>
          <i class="fa fa-star" data-rating="4"></i>
          <i class="fa fa-star" data-rating="5"></i>
      </div>
      
      <!-- Display the selected rating -->
      <p id="selected-rating">Rating: 0</p>
      <script>
        document.addEventListener("DOMContentLoaded", function() {
            const stars = document.querySelectorAll(".star-rating i");
            const ratingInput = document.getElementById("rating");
            const selectedRating = document.getElementById("selected-rating");
        
            // Initialize the selected rating based on the hidden input's value
            selectedRating.textContent = `Rating: ${ratingInput.value}`;
        
            // Add click event listeners to the star icons
            stars.forEach(star => {
                star.addEventListener("click", function() {
                    const ratingValue = parseInt(star.getAttribute("data-rating"));
                    ratingInput.value = ratingValue;
                    selectedRating.textContent = `Rating: ${ratingValue}`;
                    
                    // You can optionally add code here to submit the form when a star is clicked
                });
            });
        });
        </script>
    
           
        <button type="submit" name="create_note" class="btn btn-primary">
            Add Note
        </button>
    </form>

    <h2>Books and Notes:</h2>
    <ul>
        {% for book in books %}
        <li>
            <h3>Book Title: {{ book.title }}</h3>
            <h4>Author: {{ book.author }}</h4>
            <img src="{{ url_for('static', filename='media/cover/' + book.cover) }}" alt="Book Cover" width="200">
            <a href="/view_content/{{ book.id }}">View Content</a> <!-- Link to view PDF content -->
            {%if user.is_admin == 1%}
            <a href="/delete_book/{{ book.id }}">Delete</a>
            <a href="/update_book/{{ book.id }}">Update</a>
            {% endif %}
            <h5>Notes:</h5>
            <ul>
                {% for note in book.notes %}
                <li>
                    <p>{{ note.data }} [<strong>Comment by:</strong> {{ note.users.email }}]</p>
                    <p><strong> Time :</strong>{{ note.date_created.time() }}  {{ note.date_created.date() }}</p>
                    <div class="star-rating">
                        {% for i in range(1, note.rating + 1) %}
                            <label class="star">&#9733;</label>
                        {% endfor %}
                        {% for i in range(note.rating + 1, 6) %}
                            <label class="star">&#9734;</label>
                        {% endfor %}
                    </div>
                </li>
                {% if user.id == note.user_id %}
                <a href="/delete/{{ note.id }}">Delete</a>
                <br />
                <a href="/update/{{ note.id }}">Update</a>
                <br />
                {% endif %}
                {% endfor %}
            </ul>
        </li>
        {% endfor %}
    </ul>
</div>
{% endblock %}
